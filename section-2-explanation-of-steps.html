<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Analysis of Common Agricultural Designs in R</title>
  <meta name="description" content="A series of guidance, tutorials and examples for dealing with the data analysis of experiments following common agricultural designs using R and RStudio">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Analysis of Common Agricultural Designs in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A series of guidance, tutorials and examples for dealing with the data analysis of experiments following common agricultural designs using R and RStudio" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Analysis of Common Agricultural Designs in R" />
  
  <meta name="twitter:description" content="A series of guidance, tutorials and examples for dealing with the data analysis of experiments following common agricultural designs using R and RStudio" />
  

<meta name="author" content="Sam Dumble">


<meta name="date" content="2018-11-13">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="section-1-steps-in-analysis-using-r.html">
<link rel="next" href="section-3-methodological-principles.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#general-structure-r-syntax"><i class="fa fa-check"></i><b>2.1</b> General Structure: R Syntax</a><ul>
<li class="chapter" data-level="2.1.1" data-path="intro.html"><a href="intro.html#step-1-load-libraries"><i class="fa fa-check"></i><b>2.1.1</b> Step 1: Load Libraries</a></li>
<li class="chapter" data-level="2.1.2" data-path="intro.html"><a href="intro.html#step-2-import-data"><i class="fa fa-check"></i><b>2.1.2</b> Step 2: Import Data</a></li>
<li class="chapter" data-level="2.1.3" data-path="intro.html"><a href="intro.html#step-3-check-and-update-data"><i class="fa fa-check"></i><b>2.1.3</b> Step 3: Check and update data</a></li>
<li class="chapter" data-level="2.1.4" data-path="intro.html"><a href="intro.html#step-4.-explore-data"><i class="fa fa-check"></i><b>2.1.4</b> Step 4. Explore data</a></li>
<li class="chapter" data-level="2.1.5" data-path="intro.html"><a href="intro.html#step-5.-specify-a-model-for-data"><i class="fa fa-check"></i><b>2.1.5</b> Step 5. Specify a model for data</a></li>
<li class="chapter" data-level="2.1.6" data-path="intro.html"><a href="intro.html#step-6.-check-the-model"><i class="fa fa-check"></i><b>2.1.6</b> Step 6. Check the model</a></li>
<li class="chapter" data-level="2.1.7" data-path="intro.html"><a href="intro.html#step-7.-interpret-the-model"><i class="fa fa-check"></i><b>2.1.7</b> Step 7. Interpret the model</a></li>
<li class="chapter" data-level="2.1.8" data-path="intro.html"><a href="intro.html#step-8.-present-the-results-from-the-model"><i class="fa fa-check"></i><b>2.1.8</b> Step 8. Present the results from the model</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#general-structure-explanation-of-each-step"><i class="fa fa-check"></i><b>2.2</b> General Structure: Explanation of Each Step</a><ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#step-1-load-libraries-1"><i class="fa fa-check"></i><b>2.2.1</b> Step 1: Load Libraries</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#step-2-import-data-1"><i class="fa fa-check"></i><b>2.2.2</b> Step 2: Import Data</a></li>
<li class="chapter" data-level="2.2.3" data-path="intro.html"><a href="intro.html#step-3-check-and-update-data-1"><i class="fa fa-check"></i><b>2.2.3</b> Step 3: Check and update data</a></li>
<li class="chapter" data-level="2.2.4" data-path="intro.html"><a href="intro.html#step-4.-explore-data-1"><i class="fa fa-check"></i><b>2.2.4</b> Step 4. Explore data</a></li>
<li class="chapter" data-level="2.2.5" data-path="intro.html"><a href="intro.html#step-5.-specify-a-model-for-data-1"><i class="fa fa-check"></i><b>2.2.5</b> Step 5. Specify a model for data</a></li>
<li class="chapter" data-level="2.2.6" data-path="intro.html"><a href="intro.html#step-6.-check-the-model-1"><i class="fa fa-check"></i><b>2.2.6</b> Step 6. Check the model</a></li>
<li class="chapter" data-level="2.2.7" data-path="intro.html"><a href="intro.html#step-7.-interpret-the-model-1"><i class="fa fa-check"></i><b>2.2.7</b> Step 7. Interpret the model</a></li>
<li class="chapter" data-level="2.2.8" data-path="intro.html"><a href="intro.html#step-8.-present-the-results-from-the-model-1"><i class="fa fa-check"></i><b>2.2.8</b> Step 8. Present the results from the model</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#other-resources"><i class="fa fa-check"></i><b>2.3</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="randomised-complete-block-design-rcbd.html"><a href="randomised-complete-block-design-rcbd.html"><i class="fa fa-check"></i><b>3</b> Randomised Complete Block Design (RCBD)</a></li>
<li class="chapter" data-level="4" data-path="split-plot-designs.html"><a href="split-plot-designs.html"><i class="fa fa-check"></i><b>4</b> Split Plot Designs</a><ul>
<li class="chapter" data-level="4.1" data-path="split-plot-designs.html"><a href="split-plot-designs.html#about-the-data"><i class="fa fa-check"></i><b>4.1</b> About the data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-1-steps-in-analysis-using-r.html"><a href="section-1-steps-in-analysis-using-r.html"><i class="fa fa-check"></i><b>5</b> Section 1: Steps in analysis using R</a></li>
<li class="chapter" data-level="6" data-path="section-2-explanation-of-steps.html"><a href="section-2-explanation-of-steps.html"><i class="fa fa-check"></i><b>6</b> Section 2: Explanation of Steps</a><ul>
<li class="chapter" data-level="6.1" data-path="section-2-explanation-of-steps.html"><a href="section-2-explanation-of-steps.html#install-r-packages-needed"><i class="fa fa-check"></i><b>6.1</b> 1. Install R packages needed</a></li>
<li class="chapter" data-level="6.2" data-path="section-2-explanation-of-steps.html"><a href="section-2-explanation-of-steps.html#import-data"><i class="fa fa-check"></i><b>6.2</b> 2. Import data</a></li>
<li class="chapter" data-level="6.3" data-path="section-2-explanation-of-steps.html"><a href="section-2-explanation-of-steps.html#check-and-update-data"><i class="fa fa-check"></i><b>6.3</b> 3. Check and update data</a></li>
<li class="chapter" data-level="6.4" data-path="section-2-explanation-of-steps.html"><a href="section-2-explanation-of-steps.html#explore-data"><i class="fa fa-check"></i><b>6.4</b> 4. Explore data</a><ul>
<li class="chapter" data-level="6.4.1" data-path="section-2-explanation-of-steps.html"><a href="section-2-explanation-of-steps.html#plots"><i class="fa fa-check"></i><b>6.4.1</b> Plots</a></li>
<li class="chapter" data-level="6.4.2" data-path="section-2-explanation-of-steps.html"><a href="section-2-explanation-of-steps.html#summary-statistics"><i class="fa fa-check"></i><b>6.4.2</b> Summary Statistics</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="section-2-explanation-of-steps.html"><a href="section-2-explanation-of-steps.html#specify-a-model-for-data"><i class="fa fa-check"></i><b>6.5</b> 5. Specify a model for data</a></li>
<li class="chapter" data-level="6.6" data-path="section-2-explanation-of-steps.html"><a href="section-2-explanation-of-steps.html#check-the-model"><i class="fa fa-check"></i><b>6.6</b> 6. Check the model</a></li>
<li class="chapter" data-level="6.7" data-path="section-2-explanation-of-steps.html"><a href="section-2-explanation-of-steps.html#interpret-model"><i class="fa fa-check"></i><b>6.7</b> 7. Interpret Model</a></li>
<li class="chapter" data-level="6.8" data-path="section-2-explanation-of-steps.html"><a href="section-2-explanation-of-steps.html#present-the-results-from-the-model"><i class="fa fa-check"></i><b>6.8</b> 8. Present the results from the model</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-3-methodological-principles.html"><a href="section-3-methodological-principles.html"><i class="fa fa-check"></i><b>7</b> Section 3 – Methodological Principles</a></li>
<li class="chapter" data-level="8" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>8</b> Applications</a><ul>
<li class="chapter" data-level="8.1" data-path="applications.html"><a href="applications.html#example-one"><i class="fa fa-check"></i><b>8.1</b> Example one</a></li>
<li class="chapter" data-level="8.2" data-path="applications.html"><a href="applications.html#example-two"><i class="fa fa-check"></i><b>8.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>9</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analysis of Common Agricultural Designs in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-2-explanation-of-steps" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Section 2: Explanation of Steps</h1>
<div id="install-r-packages-needed" class="section level2">
<h2><span class="header-section-number">6.1</span> 1. Install R packages needed</h2>
<p>A number of packages following packages were used during data exploration and analysis. For a general introduction explaining what R packages are and how they work, this is a really useful guide <a href="https://www.datacamp.com/community/tutorials/r-packages-guide" class="uri">https://www.datacamp.com/community/tutorials/r-packages-guide</a>. For each of these packages to be installed, using install.packages(), this requires a reliable internet connection and a correctly installed version of R and RStudio. If you are having difficulties installing these packages please ask for help.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)
<span class="kw">library</span>(ggplot2)</code></pre></div>
<p><code>ggplot2</code> This package provides a powerful graphics language for creating elegant and complex graphs in R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;emmeans&quot;</span>)
<span class="kw">library</span>(emmeans)</code></pre></div>
<p><code>emmeans</code> Estimated marginal means (also known as least squares means) helps provide expected mean values and confidence intervals from statistical models.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;doBy&quot;</span>)
<span class="kw">library</span>(doBy)</code></pre></div>
<p><code>doBy</code>Allows easy production of summary statistic tables</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;lmerTest&quot;</span>)
<span class="kw">library</span>(lmerTest)</code></pre></div>
<p><code>lmerTest</code> Allows produce of flexible mixed effects regression models, similar to REML in Genstat.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;multcompView&quot;</span>)
<span class="kw">library</span>(multcompView)</code></pre></div>
<p><code>multcompView</code> allows for mean seperation methods on analyses</p>
</div>
<div id="import-data" class="section level2">
<h2><span class="header-section-number">6.2</span> 2. Import data</h2>
<p>Our data set saved as a CSV file, so we can use the read.csv commmand to import the data. We are going to assign the name of the data with R to be <code>fphosphorus</code>. Remember in R Studio you could also use the “Import Dataset” menu to import a dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fphosphorus  &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/Admin/Desktop/FPhosphorus.csv&quot;</span>)</code></pre></div>
</div>
<div id="check-and-update-data" class="section level2">
<h2><span class="header-section-number">6.3</span> 3. Check and update data</h2>
<p>When reading data into R it is always useful to check that data is in the format expected. How many variables are there? How many rows? How have the columns been read in? The summary command can help to show if the data is being treated correctly.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(fphosphorus)</code></pre></div>
<pre><code>##      farmer       block      mainplot       subplot   
##  BTS-10 : 8   Min.   :1   Min.   :1.00   Min.   :1.0  
##  BTS-10B: 8   1st Qu.:3   1st Qu.:1.75   1st Qu.:1.0  
##  BTS-18 : 8   Median :5   Median :2.50   Median :1.5  
##  BTS-25 : 8   Mean   :5   Mean   :2.50   Mean   :1.5  
##  BTS-27 : 8   3rd Qu.:7   3rd Qu.:3.25   3rd Qu.:2.0  
##  BTS-32 : 8   Max.   :9   Max.   :4.00   Max.   :2.0  
##  (Other):24                                           
##              fallow   nitrogen     grain         striga1       
##  Continous Maize:18   No :36   Min.   :0.00   Min.   :   7.00  
##  Crotolaria     :18   Yes:36   1st Qu.:0.60   1st Qu.:  86.75  
##  Tephrosia      :18            Median :1.25   Median : 323.50  
##  Tithonia       :18            Mean   :1.70   Mean   : 582.04  
##                                3rd Qu.:2.40   3rd Qu.: 852.25  
##                                Max.   :5.30   Max.   :2999.00  
##                                                                
##     striga2           striga3          striga4      
##  Min.   :   2.00   Min.   :   0.0   Min.   :   0.0  
##  1st Qu.:  13.75   1st Qu.:  10.0   1st Qu.:  17.0  
##  Median : 137.50   Median :  29.5   Median : 172.0  
##  Mean   : 566.11   Mean   :  84.4   Mean   : 337.7  
##  3rd Qu.: 926.00   3rd Qu.:  78.5   3rd Qu.: 448.5  
##  Max.   :2645.00   Max.   :1208.0   Max.   :1406.0  
##                                     NA&#39;s   :32</code></pre>
<p>Where data is being treated as a numeric variable (i.e. a number) <code>summary</code> provides statistics like the mean, min and max. Where data is being treated like a categorical variable (i.e. a group) then summary provides frequency tables.</p>
<p>From the results we can see that the variables block, mainplor and subplot are being considered as numeric variables. However these are grouping variables, not number variables, the numbers used are simply codes. If we do not rectify this then our analysis later will be incorrect and meaningless.<br />
This can also be seen more explicitly using the str() function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(fphosphorus)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    72 obs. of  11 variables:
##  $ farmer  : Factor w/ 9 levels &quot;BTS-10&quot;,&quot;BTS-10B&quot;,..: 1 1 1 1 1 1 1 1 2 2 ...
##  $ block   : int  7 7 7 7 7 7 7 7 8 8 ...
##  $ mainplot: int  1 1 2 2 3 3 4 4 1 1 ...
##  $ subplot : int  1 2 1 2 1 2 1 2 1 2 ...
##  $ fallow  : Factor w/ 4 levels &quot;Continous Maize&quot;,..: 1 1 4 4 2 2 3 3 3 3 ...
##  $ nitrogen: Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 2 2 1 2 1 2 1 1 2 ...
##  $ grain   : num  0.8 3 2.2 2.4 1.2 3 0.9 4.1 0.4 0.5 ...
##  $ striga1 : int  1438 1340 482 340 98 90 232 120 2854 1715 ...
##  $ striga2 : int  1736 960 2092 660 680 921 2645 1033 1709 941 ...
##  $ striga3 : int  37 16 63 32 15 57 57 95 12 24 ...
##  $ striga4 : int  NA NA NA NA NA NA NA NA NA NA ...</code></pre>
<p>So we need to convert these variables into factors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fphosphorus<span class="op">$</span>block&lt;-<span class="kw">factor</span>(fphosphorus<span class="op">$</span>block)
fphosphorus<span class="op">$</span>mainplot&lt;-<span class="kw">factor</span>(fphosphorus<span class="op">$</span>mainplot)
fphosphorus<span class="op">$</span>subplot&lt;-<span class="kw">factor</span>(fphosphorus<span class="op">$</span>subplot)</code></pre></div>
<p>These commands take the column block within the data frame fphosphorus, converts into a factor and saves the result in a column called block within fphosphorus</p>
</div>
<div id="explore-data" class="section level2">
<h2><span class="header-section-number">6.4</span> 4. Explore data</h2>
<div id="plots" class="section level3">
<h3><span class="header-section-number">6.4.1</span> Plots</h3>
<p>In Tutorial 1 we produced plots showing all of the data plotted as points, like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>fphosphorus,<span class="kw">aes</span>(<span class="dt">y=</span>grain,<span class="dt">x=</span>fallow,<span class="dt">colour=</span>nitrogen))<span class="op">+</span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-21-1.png" width="672" /> But in this instance there are too many points to be able to fully understand how the results are distributed. In this case we would get better information through looking at some boxplots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>fphosphorus,<span class="kw">aes</span>(<span class="dt">y=</span>grain,<span class="dt">x=</span>fallow,<span class="dt">colour=</span>nitrogen))<span class="op">+</span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
<div id="summary-statistics" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Summary Statistics</h3>
<p>Using the summaryBy() function makes it easy to split summary statsitics into groups based on more than one factor. So the combination of fallow treatment and nitrogen treatment can be obtained using a + sign between the two variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summaryBy</span>(grain<span class="op">~</span>fallow<span class="op">+</span>nitrogen, <span class="dt">data=</span>fphosphorus, <span class="dt">FUN=</span><span class="kw">c</span>(mean,sd))</code></pre></div>
<pre><code>##            fallow nitrogen grain.mean grain.sd
## 1 Continous Maize       No   1.277778 1.446356
## 2 Continous Maize      Yes   2.100000 1.948718
## 3      Crotolaria       No   2.322222 1.475447
## 4      Crotolaria      Yes   1.988889 1.334583
## 5       Tephrosia       No   1.255556 1.181219
## 6       Tephrosia      Yes   1.733333 1.024695
## 7        Tithonia       No   1.255556 1.125956
## 8        Tithonia      Yes   1.666667 1.736376</code></pre>
</div>
</div>
<div id="specify-a-model-for-data" class="section level2">
<h2><span class="header-section-number">6.5</span> 5. Specify a model for data</h2>
<p>In this design, a split plot desin, we have two treatment factors, “fallow” and “nitrogen”, and two layout factors “block” and “mainplot”.</p>
<p>In order to test the “main effects” of the treatmetns as well as the interaction between the two factors, then we need to make sure the formula is specified as factor1*factor2. Using factor1+factor2 will only include the main effects and not include the interaction.</p>
<p>When dealing with the split plot design, across multiple blocks, then the random effects need to be nested hierachically, from biggest down to smallest. This is done with a random effect that includes a / and looks like (1|biggestlayoutunit/nextbiggestlayout unit).</p>
<p>So the model we want to fit therefore looks like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">splitplotmodel1&lt;-<span class="kw">lmer</span>(grain<span class="op">~</span>fallow<span class="op">*</span>nitrogen<span class="op">+</span>(<span class="dv">1</span><span class="op">|</span>block<span class="op">/</span>mainplot), <span class="dt">data=</span>fphosphorus)</code></pre></div>
<p>R is unlike many other software packages in how it fits models. The best way of handling models in R is to assign the model to a name (in this case rcbdmodel1) and then ask R to provide different sorts of output for this model. When you run the above line you will get now output from the data - this is what we expected to see!</p>
</div>
<div id="check-the-model" class="section level2">
<h2><span class="header-section-number">6.6</span> 6. Check the model</h2>
<p>Before interpretting the model any further we should investigate the model validity, to ensure any conclusions we draw are valid. There are 3 assumptions that we can check for using standard model checking plots. 1. Homogeneity (equal variance) 2. Values with high leverage 3. Normality of residuals</p>
<p>The function plot() when used with a model will plot the fitted values from the model against the expected values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(splitplotmodel1)</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-25-1.png" width="672" /> The residual Vs fitted plot is a scatter plot of the Residuals on the y-axis and the fitted on the x-axis and the aim for this plot is to test the assumption of equal variance of the residuals across the range of fitted values. There is someevidence of non-constant variance in our plot - residual values are less varaable around lower fitted values, and more variable around higher fitted values. This issue can often be solved by using a logaithmic or square root transformation. In this case, because there are some zero values within our data, it may be better to use a square root transformation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">splitplotmodel2&lt;-<span class="kw">lmer</span>(<span class="kw">sqrt</span>(grain)<span class="op">~</span>fallow<span class="op">*</span>nitrogen<span class="op">+</span>(<span class="dv">1</span><span class="op">|</span>block<span class="op">/</span>mainplot), <span class="dt">data=</span>fphosphorus)</code></pre></div>
<p>Refitting the plot shows a better approximation of heterogeneity, that is more acceptable to the assumptions required.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(splitplotmodel2)</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-27-1.png" width="672" /> We can also see that there are no extreme values in the residuals which might be potentially causing problems with the validity of our conclusions (leverage)</p>
<p>To assess the assumption of normality we can produce a qqplot. This shows us how closely the residuals follow a normal distribution - if there are severe and syste,matic deviations from the line then we may want to consider an alternative distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qqnorm</span>(<span class="kw">resid</span>(splitplotmodel2))
<span class="kw">qqline</span>(<span class="kw">resid</span>(splitplotmodel2))</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-28-1.png" width="672" /> In this case the residuals seem to fit the assumption required for normality.</p>
</div>
<div id="interpret-model" class="section level2">
<h2><span class="header-section-number">6.7</span> 7. Interpret Model</h2>
<p>The anova() function only prints the rows of analysis of variance table for treatment effects when looking at a mixed model fitted using lmer().</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(splitplotmodel2,<span class="dt">ddf=</span><span class="st">&quot;Kenward-Roger&quot;</span>)</code></pre></div>
<pre><code>## Type III Analysis of Variance Table with Kenward-Roger&#39;s method
##                  Sum Sq Mean Sq NumDF DenDF F value Pr(&gt;F)
## fallow          0.38006 0.12669     3    24  1.0112 0.4050
## nitrogen        0.27129 0.27129     1    32  2.1653 0.1509
## fallow:nitrogen 0.37536 0.12512     3    32  0.9987 0.4061</code></pre>
<p>ddf=Kenward-Roger tells R which method to use for determining the calculations of the table; this option matches the defaults found within SAS or Genstat. The ANOVA table suggests a highly significant effect of the treatment on the yield.</p>
<p>To obtain the residual variance, and the variance attributed to the blocks we need an additional command. From these number it is possible to reconstruct a more classic ANOVA table, if so desired.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">VarCorr</span>(splitplotmodel1), <span class="dt">comp=</span>(<span class="st">&quot;Variance&quot;</span>))</code></pre></div>
<pre><code>##  Groups         Name        Variance
##  mainplot:block (Intercept) 0.38238 
##  block          (Intercept) 0.64581 
##  Residual                   1.04375</code></pre>
</div>
<div id="present-the-results-from-the-model" class="section level2">
<h2><span class="header-section-number">6.8</span> 8. Present the results from the model</h2>
<p>To help understand what the significant result from the ANOVA table means we can produce several plots and tables to help us. First we can use the function emmip() to produce plots of the modelled results, including 95% confidence intervals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">emmip</span>(splitplotmodel2,nitrogen<span class="op">~</span>fallow,<span class="dt">CIs =</span> <span class="ot">TRUE</span>,<span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>To obtain the numbers used in creating this graph we can use the function emmeans.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">emmeans</span>(splitplotmodel1, <span class="op">~</span>fallow)</code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code>##  fallow            emmean       SE    df  lower.CL upper.CL
##  Continous Maize 1.688889 0.415006 21.04 0.8259423 2.551835
##  Crotolaria      2.155556 0.415006 21.04 1.2926090 3.018502
##  Tephrosia       1.494444 0.415006 21.04 0.6314978 2.357391
##  Tithonia        1.461111 0.415006 21.04 0.5981645 2.324058
## 
## Results are averaged over the levels of: nitrogen 
## Degrees-of-freedom method: kenward-roger 
## Confidence level used: 0.95</code></pre>
<p>And one method for conducting mean separation analysis we can use the function cld().</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cld</span>(<span class="kw">emmeans</span>(splitplotmodel1, <span class="op">~</span>fallow))</code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code>##  fallow            emmean       SE    df  lower.CL upper.CL .group
##  Tithonia        1.461111 0.415006 21.04 0.5981645 2.324058  1    
##  Tephrosia       1.494444 0.415006 21.04 0.6314978 2.357391  1    
##  Continous Maize 1.688889 0.415006 21.04 0.8259423 2.551835  1    
##  Crotolaria      2.155556 0.415006 21.04 1.2926090 3.018502  1    
## 
## Results are averaged over the levels of: nitrogen 
## Degrees-of-freedom method: kenward-roger 
## Confidence level used: 0.95 
## P value adjustment: tukey method for comparing a family of 4 estimates 
## significance level used: alpha = 0.05</code></pre>
<p>In the output, groups sharing a letter in the .group are not statistically different from each other.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-1-steps-in-analysis-using-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-3-methodological-principles.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/03-splitplot.Rmd",
"text": "Edit"
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
